<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ²ç¤ºæ¿è©³ç´°</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/main.css}">
    <style>

    </style>
</head>
<body>
<script th:inline="javascript">
    var errorMsg = /*[[${error}]]*/ null;
    var successMsg = /*[[${success}]]*/ null;
    if (errorMsg){
        alert(errorMsg);
    }
    if (successMsg){
        alert(successMsg);
    }
</script>
<a th:href="@{/}">
    <h1 th:text="${board.title}"></h1>
</a>

<div class="board-detail">

    <!-- æƒ…å ± -->
    <div class="board-info">
        ä½œæˆè€…: <span th:text="${board.user.username}"></span> |
        ä½œæˆæ—¥: <span th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}"></span> |
        ã‚¯ãƒªãƒƒã‚¯æ•°: <span th:text="${board.views}"></span>
    </div>

    <!-- æœ¬æ–‡ -->
    <div class="board-context">
        <p th:text="${board.context}"></p>
    </div>

    <!--ã€€æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã€€ãƒªã‚¹ãƒˆã€€-->
    <div class="file-section" th:if="${!#lists.isEmpty(files)}">
        <h4>ğŸ“ æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ« ([[${#lists.size(files)}]]å€‹)</h4>

        <div class="file-list">
            <!-- ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚’ç¹°ã‚Šè¿”ã™ -->
            <div class="file-item" th:each="file : ${files}">
                <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ -->
                <span class="file-icon">
                    <span th:if="${file.fileType.startsWith('image')}">ğŸ–¼ï¸</span>
                    <span th:if="${file.fileType == 'application/pdf'}">ğŸ“„</span>
                    <span th:unless="${file.fileType.startsWith('image') or file.fileType == 'application/pdf'}">ğŸ“</span>
                </span>

                <!-- ãƒ•ã‚¡ã‚¤ãƒ«åã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ -->
                <a th:href="@{/file/download/{fileId}(fileId=${file.id})}"
                    th:text="${file.oriFileName}"
                    class="file-link">
                </a>

                <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã®å®¹é‡è¡¨ç¤º -->
                <span class="file-size">
                    ([[${#numbers.formatDecimal(file.fileSize / 1024, 1, 1)}]] KB)
                </span>

                <!-- ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                <div th:if="${session.loginUser != null and session.loginUser.id == board.user.id}"
                    style="display: inline;">
                    <form th:action="@{/file/delete/{fileId}(fileId=${file.id})}"
                            method="post"
                            style="display: inline;"
                            onsubmit="return confirm('ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
                        <input type="hidden" name="boardId" th:value="${board.id}">
                        <button type="submit" class="file-delete-btn">âŒ</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div>
        <!-- sessionç¢ºèª -->
        <div th:if="${session.loginUser != null and session.loginUser.id == board.user.id}">
            <!-- ä¿®æ­£ -->
            <button type="button" class="button" th:onclick="'location.href=\'' + @{/board/{id}/edit(id=${board.id})} + '\''">ä¿®æ­£</button>
            <!-- å‰Šé™¤ -->
            <form th:action="@{/board/{id}/delete(id=${board.id})}"
                  method="post"
                  style="display: inline;"
                  onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹?');">
                <button type="submit" class="button button-delete">å‰Šé™¤</button>
            </form>
        </div>
        <a href="/board/list">ãƒªã‚¹ãƒˆã«æˆ»ã‚‹</a>
    </div>

    <div class="comment-section">
        <h3>ã‚³ãƒ¡ãƒ³ãƒˆ ([[${commentCount}]])</h3>
        <div class="comment-form" th:if="${session.loginUser}">
            <form action="/comment/create" method="post">
                <input type="hidden" name="boardId" th:value="${board.id}">
                <textarea name="content"
                        rows="3" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ï¼"
                        required></textarea>
                <div style="margin-top: 10px;">
                    <button type="submit">ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆ</button>
                </div>
            </form>
        </div>
        <div class="comment-list">
            <div class="comment-item" th:each="comment : ${comments}">
                <div class="comment-header">
                    <strong th:text="${comment.user.username}"></strong>
                    <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                </div>
                <div class="comment-content">
                    <p th:text="${comment.content}"></p>
                </div>
                <div th:if="${session.loginUser != null and session.loginUser.id == comment.user.id}">
                    <form th:action="@{/comment/delete/{commentId}(commentId=${comment.id})}"
                            method="post" style="display: inline" onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                        <input type="hidden" name="boardId" th:value="${board.id}">
                        <button type="submit" class="button comment-delete">å‰Šé™¤</button>
                    </form>
                </div>
                <div th:if="${#lists.isEmpty(comments)}" style="text-align: center; padding: 20px; color: #999;">
                    ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ï¼
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>