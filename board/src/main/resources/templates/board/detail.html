<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <title>掲示板詳細</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/main.css}">
    <style>

    </style>
</head>
<body>
<script th:inline="javascript">
    var errorMsg = /*[[${error}]]*/ null;
    var successMsg = /*[[${success}]]*/ null;
    if (errorMsg){
        alert(errorMsg);
    }
    if (successMsg){
        alert(successMsg);
    }
</script>
<a th:href="@{/}">
    <h1 th:text="${board.title}"></h1>
</a>

<div class="board-detail">

    <!-- 情報 -->
    <div class="board-info">
        作成者: <span th:text="${board.user.username}"></span> |
        作成日: <span th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}"></span> |
        クリック数: <span th:text="${board.views}"></span>
    </div>

    <!-- 本文 -->
    <div class="board-context">
        <p th:text="${board.context}"></p>
    </div>

    <div>
        <!-- session確認 -->
        <div th:if="${session.loginUser != null and session.loginUser.id == board.user.id}">
            <!-- 修正 -->
            <a th:href="@{/board/{id}/edit(id=${board.id})}" class="button">修正</a>
            <!-- 削除 -->
            <form th:action="@{/board/{id}/delete(id=${board.id})}"
                  method="post"
                  style="display: inline;"
                  onsubmit="return confirm('本当に削除しますか?');">
                <button type="submit" class="button .button-delete">削除</button>
            </form>
        </div>
        <a href="/board/list">リストに戻る</a>
    </div>

    <div class="comment-section">
        <h3>コメント ([[${commentCount}]])</h3>
        <div class="comment-form" th:if="${session.loginUser}">
            <form action="/comment/create" method="post">
                <input type="hidden" name="boardId" th:value="${board.id}">
                <textarea name="content"
                        rows="3" placeholder="コメントを入力してください！！"
                        required></textarea>
                <div style="margin-top: 10px;">
                    <button type="submit">コメントを作成</button>
                </div>
            </form>
        </div>
        <div class="comment-list">
            <div class="comment-item" th:each="comment : ${comments}">
                <div class="comment-header">
                    <strong th:text="${comment.user.username}"></strong>
                    <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                </div>
                <div class="comment-content">
                    <p th:text="${comment.content}"></p>
                </div>
                <div th:if="${session.loginUser != null and session.loginUser.id == comment.user.id}">
                    <form th:action="@{/comment/delete/{commentId}(commentId=${comment.id})}"
                            method="post" style="display: inline" onsubmit="return confirm('本当に削除しますか？')">
                        <input type="hidden" name="boardId" th:value="${board.id}">
                        <button type="submit" class="button comment-delete">削除</button>
                    </form>
                </div>
                <div th:if="${#lists.isEmpty(comments)}" style="text-align: center; padding: 20px; color: #999;">
                    コメントがありません！
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>